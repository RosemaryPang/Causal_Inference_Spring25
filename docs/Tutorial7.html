<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Tutorial_7 – DACSS790 Causal Inference Spring 2025</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">DACSS790 Causal Inference Spring 2025</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Tutorial1.html"> 
<span class="menu-text">Tutorial1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Tutorial2.html"> 
<span class="menu-text">Tutorial2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Tutorial3.html"> 
<span class="menu-text">Tutorial3</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Tutorial4.html"> 
<span class="menu-text">Tutorial4</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Tutorial5.html"> 
<span class="menu-text">Tutorial5</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Tutorial6.html"> 
<span class="menu-text">Tutorial6</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./Tutorial7.html" aria-current="page"> 
<span class="menu-text">Tutorial7</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#front-end-matters" id="toc-front-end-matters" class="nav-link active" data-scroll-target="#front-end-matters">Front-end Matters</a></li>
  <li><a href="#basic-did-textbook-organ-donations-example" id="toc-basic-did-textbook-organ-donations-example" class="nav-link" data-scroll-target="#basic-did-textbook-organ-donations-example">Basic DID: Textbook Organ Donations Example</a></li>
  <li><a href="#evaluating-parallel-trends" id="toc-evaluating-parallel-trends" class="nav-link" data-scroll-target="#evaluating-parallel-trends">Evaluating Parallel Trends</a>
  <ul class="collapse">
  <li><a href="#test-of-prior-trends" id="toc-test-of-prior-trends" class="nav-link" data-scroll-target="#test-of-prior-trends">Test of prior trends</a></li>
  <li><a href="#placebo-test" id="toc-placebo-test" class="nav-link" data-scroll-target="#placebo-test">Placebo Test</a></li>
  </ul></li>
  <li><a href="#long-term-effect" id="toc-long-term-effect" class="nav-link" data-scroll-target="#long-term-effect">Long-term Effect</a></li>
  <li><a href="#non-textbook-more-complicated-did-example" id="toc-non-textbook-more-complicated-did-example" class="nav-link" data-scroll-target="#non-textbook-more-complicated-did-example">Non-Textbook (More Complicated) DID Example</a>
  <ul class="collapse">
  <li><a href="#setting-treatment-group-variable" id="toc-setting-treatment-group-variable" class="nav-link" data-scroll-target="#setting-treatment-group-variable">Setting Treatment Group Variable</a></li>
  <li><a href="#placebo-test-1" id="toc-placebo-test-1" class="nav-link" data-scroll-target="#placebo-test-1">Placebo test</a></li>
  <li><a href="#did" id="toc-did" class="nav-link" data-scroll-target="#did">DID</a></li>
  <li><a href="#did-with-control" id="toc-did-with-control" class="nav-link" data-scroll-target="#did-with-control">DID with control</a></li>
  <li><a href="#long-term-effect-1" id="toc-long-term-effect-1" class="nav-link" data-scroll-target="#long-term-effect-1">Long term effect</a></li>
  </ul></li>
  <li><a href="#rollout-design" id="toc-rollout-design" class="nav-link" data-scroll-target="#rollout-design">Rollout Design</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tutorial 7 Difference in Differences</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>Difference-in-Differences (DID)</strong> is a foundational method in causal inference, used to estimate treatment effects in observational settings by comparing treated and untreated units over time. This tutorial walks you through the key steps in implementing DID in R. You’ll learn how to prepare data for DID analysis, visualize group trends, and estimate treatment effects using interaction models. We’ll also explore techniques to assess the credibility of your assumptions and extend the basic DID framework to handle more complex research designs.</p>
<p>By the end of this tutorial, you will be familiar with:</p>
<p>1 .&nbsp;Basic Difference-in-Differences (DID) model</p>
<p>2 .&nbsp;Evaluating the parallel trends assumption</p>
<p>3 .&nbsp;Exploring the long-term effects of treatment</p>
<p>4 .&nbsp;Modeling rollout designs</p>
<section id="front-end-matters" class="level1">
<h1>Front-end Matters</h1>
<p>DID estimation is closely related to Two-Way Fixed Effects (TWFE) models. To implement these models efficiently in R, we’ll use the <code>fixest</code> package, which offers a flexible and high-performance framework for fixed effects regression.</p>
<p>We’ll also use: <code>tidyverse</code> for data wrangling, plotting, and reshaping; and <code>wooldridge</code> to access the <code>wagepan</code> dataset, a common example for panel data applications.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("did")</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(did)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(foreign)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"wagepan"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in data("wagepan"): data set 'wagepan' not found</code></pre>
</div>
</div>
</section>
<section id="basic-did-textbook-organ-donations-example" class="level1">
<h1>Basic DID: Textbook Organ Donations Example</h1>
<p>In this example from <em>The Effect</em>, we estimate the causal effect of California’s 2011 organ donation policy using a Difference-in-Differences design. The policy changed organ donation from ‘opt in’ to ‘ative choice’ when renewing their driver’s license. We define the treatment as California in quarters Q3 2011, Q4 2011, and Q1 2012, and use other U.S. states as the control group. By applying a Two-Way Fixed Effects model with state and quarter fixed effects, we isolate the treatment effect while controlling for state-specific characteristics and common time shocks.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>od <span class="ot">&lt;-</span> causaldata<span class="sc">::</span>organ_donations</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(od)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  State  Quarter  Rate Quarter_Num
  &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt;       &lt;int&gt;
1 Alaska Q42010   0.75           1
2 Alaska Q12011   0.77           2
3 Alaska Q22011   0.77           3
4 Alaska Q32011   0.78           4
5 Alaska Q42011   0.78           5
6 Alaska Q12012   0.79           6</code></pre>
</div>
</div>
<p>The dataset has four columns: State, Quarter, Rate, and Quarter Number. To estimate DID model, we first need to define: The <strong>treated group</strong>: California and the <strong>post-treatment periods</strong>: Q32011, Q42011, and Q12012.</p>
<p>We’ll create a binary <em>Treated</em> variable that equals 1 for California in those three quarters, and 0 otherwise. Then we’ll estimate a TWFE model using the <code>fixest</code> package. This allows us to control for state-specific characteristics and quarter-specific shocks.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define treated group: California in post-treatment quarters</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>od <span class="ot">&lt;-</span> od <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Treated =</span> State <span class="sc">==</span> <span class="st">'California'</span> <span class="sc">&amp;</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>         Quarter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Q32011'</span>, <span class="st">'Q42011'</span>, <span class="st">'Q12012'</span>))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(od)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  State  Quarter  Rate Quarter_Num Treated
  &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt;       &lt;int&gt; &lt;lgl&gt;  
1 Alaska Q42010   0.75           1 FALSE  
2 Alaska Q12011   0.77           2 FALSE  
3 Alaska Q22011   0.77           3 FALSE  
4 Alaska Q32011   0.78           4 FALSE  
5 Alaska Q42011   0.78           5 FALSE  
6 Alaska Q12012   0.79           6 FALSE  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate DID with two-way fixed effects</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>odfe <span class="ot">&lt;-</span> <span class="fu">feols</span>(Rate <span class="sc">~</span> Treated <span class="sc">|</span> State <span class="sc">+</span> Quarter, <span class="at">data =</span> od)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(odfe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OLS estimation, Dep. Var.: Rate
Observations: 162
Fixed-effects: State: 27,  Quarter: 6
Standard-errors: Clustered (State) 
             Estimate Std. Error  t value  Pr(&gt;|t|)    
TreatedTRUE -0.022459   0.006131 -3.66304 0.0011185 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.021982     Adj. R2: 0.974196
                 Within R2: 0.009221</code></pre>
</div>
</div>
<p><strong>TreatedTRUE</strong> is the DID estimate — it captures the difference in average donor registration rates for California after the policy change, relative to the <strong>change</strong> in control states over the same period The policy is associated with a 2.25 percentage point decrease in donor registration rates, compared to what we would have expected based on the control states. The result is statistically significant.</p>
</section>
<section id="evaluating-parallel-trends" class="level1">
<h1>Evaluating Parallel Trends</h1>
<section id="test-of-prior-trends" class="level2">
<h2 class="anchored" data-anchor-id="test-of-prior-trends">Test of prior trends</h2>
<p>Before we can trust a Difference-in-Differences (DID) estimate, we need to evaluate whether the treated and control groups were following similar trends before the treatment — this is known as the parallel trends assumption. One way to assess this is by running a prior trend test, which looks only at pre-treatment data. In this test, we regress the outcome on time (as a numeric variable), a treatment group indicator, and an interaction between the two. The key idea is that if the two groups had similar trends before treatment, the interaction term — which captures whether the slope differs by group — should be statistically indistinguishable from zero.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Only use pre-treatmeent data</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>od_pre <span class="ot">&lt;-</span> causaldata<span class="sc">::</span>organ_donations <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Quarter_Num <span class="sc">&lt;=</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Time =</span> Quarter_Num,                      <span class="co"># numeric time</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Group =</span> <span class="fu">if_else</span>(State <span class="sc">==</span> <span class="st">"California"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate linear trend test</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>priortrend <span class="ot">&lt;-</span><span class="fu">feols</span>(Rate <span class="sc">~</span> Time <span class="sc">+</span> Time<span class="sc">:</span>Group <span class="sc">|</span> State, <span class="at">data =</span> od_pre)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(priortrend)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OLS estimation, Dep. Var.: Rate
Observations: 81
Fixed-effects: State: 27
Standard-errors: Clustered (State) 
           Estimate Std. Error  t value Pr(&gt;|t|) 
Time       0.002379   0.002493 0.954120  0.34881 
Time:Group 0.001471   0.002493 0.590058  0.56025 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.01259     Adj. R2: 0.990071
                Within R2: 0.024607</code></pre>
</div>
</div>
<p>The output from our prior trend test shows that the coefficient on the interaction term (Time × Group) is approximately 0.0015, with a p-value of 0.56. This suggests that there is no statistically significant difference in the linear trend of donor registration rates between California and the control states during the pre-treatment period. In other words, California and the control states were on parallel paths before the policy was implemented, supporting the validity of the DID design.</p>
</section>
<section id="placebo-test" class="level2">
<h2 class="anchored" data-anchor-id="placebo-test">Placebo Test</h2>
<p>To test the plausibility of the parallel trends assumption, we can also conduct a placebo test using only pre-treatment data. We create two fake treatment indicators: one pretending California was treated in both Q1 and Q2 of 2011, and another pretending the treatment occurred only in Q2 2011. We then re-estimate the same DID model as before, but using these fake treatment periods. If the estimated effects are close to zero and statistically insignificant, this supports the idea that California and the control states were following similar trends prior to the actual policy change.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use only pre-treatment data</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>od <span class="ot">&lt;-</span> causaldata<span class="sc">::</span>organ_donations <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Quarter_Num <span class="sc">&lt;=</span> <span class="dv">3</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create our fake treatment variables</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>od <span class="ot">&lt;-</span> od <span class="sc">%&gt;%</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">FakeTreat1 =</span> State <span class="sc">==</span> <span class="st">'California'</span> <span class="sc">&amp;</span> </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>           Quarter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Q12011'</span>,<span class="st">'Q22011'</span>),</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">FakeTreat2 =</span> State <span class="sc">==</span> <span class="st">'California'</span> <span class="sc">&amp;</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>           Quarter <span class="sc">==</span> <span class="st">'Q22011'</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the same model we did before but with our fake treatment</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>placebo1 <span class="ot">&lt;-</span> <span class="fu">feols</span>(Rate <span class="sc">~</span> FakeTreat1 <span class="sc">|</span> State <span class="sc">+</span> Quarter,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> od)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>placebo2 <span class="ot">&lt;-</span> <span class="fu">feols</span>(Rate <span class="sc">~</span> FakeTreat2 <span class="sc">|</span> State <span class="sc">+</span> Quarter,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> od)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(placebo1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OLS estimation, Dep. Var.: Rate
Observations: 81
Fixed-effects: State: 27,  Quarter: 3
Standard-errors: Clustered (State) 
               Estimate Std. Error t value Pr(&gt;|t|) 
FakeTreat1TRUE  0.00609   0.005088 1.19698  0.24211 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.012373     Adj. R2: 0.990222
                 Within R2: 0.001917</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(placebo2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OLS estimation, Dep. Var.: Rate
Observations: 81
Fixed-effects: State: 27,  Quarter: 3
Standard-errors: Clustered (State) 
                Estimate Std. Error  t value Pr(&gt;|t|) 
FakeTreat2TRUE -0.001677   0.002797 -0.59958  0.55398 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.012384     Adj. R2: 0.990205
                 Within R2: 1.453e-4</code></pre>
</div>
</div>
<p>The results from the placebo test show that neither fake treatment variable produces a statistically significant effect. For FakeTreat1, the estimated effect is 0.0061 with a p-value of 0.24. For FakeTreat2, the estimate is –0.0017 with a p-value of 0.55. Both coefficients are small in magnitude and far from statistical significance. This suggests that California and the control states did not exhibit differential trends during the pre-treatment period, which supports the parallel trends assumption underlying the Difference-in-Differences design.</p>
</section>
</section>
<section id="long-term-effect" class="level1">
<h1>Long-term Effect</h1>
<p>To examine how the treatment effect evolves over time, we estimate a model that interacts each quarter with the treated group indicator. This allows us to observe the treatment effect in each specific period, rather than averaging across all post-treatment quarters. Using the <code>i()</code> function from the fixest package, we create interaction terms between each quarter and whether the state is California. We also set Quarter 3 (the last pre-treatment period) as the reference group, so all estimated coefficients represent the change in California relative to the control states and relative to that baseline period. This approach helps us identify both long-term effects and any pre-existing trends that may violate the parallel trends assumption.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>od <span class="ot">&lt;-</span> causaldata<span class="sc">::</span>organ_donations</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Treatment variable</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>od <span class="ot">&lt;-</span> od <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">California =</span> State <span class="sc">==</span> <span class="st">'California'</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Interact quarter with being in the treated group</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>longterm <span class="ot">&lt;-</span> <span class="fu">feols</span>(Rate <span class="sc">~</span> <span class="fu">i</span>(Quarter_Num, California, <span class="at">ref =</span> <span class="dv">3</span>) <span class="sc">|</span> </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>            State <span class="sc">+</span> Quarter_Num, <span class="at">data =</span> od)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(longterm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OLS estimation, Dep. Var.: Rate
Observations: 162
Fixed-effects: State: 27,  Quarter_Num: 6
Standard-errors: Clustered (State) 
                           Estimate Std. Error   t value   Pr(&gt;|t|)    
Quarter_Num::1:California -0.002942   0.005084 -0.578719 0.56775872    
Quarter_Num::2:California  0.006296   0.002266  2.778832 0.00999724 ** 
Quarter_Num::4:California -0.021565   0.005034 -4.284177 0.00022209 ***
Quarter_Num::5:California -0.020292   0.004473 -4.536282 0.00011432 ***
Quarter_Num::6:California -0.022165   0.010013 -2.213610 0.03583451 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.021976     Adj. R2: 0.973385
                 Within R2: 0.009787</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># And use coefplot() for a graph of effects</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coefplot</span>(longterm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Tutorial7_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The long-term effects model estimates the impact of California’s policy change in each quarter, relative to the baseline period (Quarter 3, the last pre-treatment quarter). The results show that there is no significant difference in Quarter 1 or Quarter 3, but there is a significant positive deviation in Quarter 2 (pre-treatment), which may raise concerns about the parallel trends assumption. That’s not ideal, but a single dynamic effect behaving badly isn’t a reason to throw out the whole model In the post-treatment quarters (Q4, Q5, Q6), the coefficients are all statistically significant and negative, suggesting that the policy led to a sustained decrease in organ donor registration rates relative to the control states and the pre-treatment baseline.</p>
<p>It’s worth noting that the Average Treatment Effect on the Treated (ATT) in a standard DID model can be statistically significant even if none of the long-term effect coefficients are, or vice versa. This can happen for a few reasons:</p>
<ul>
<li><p>Timing: The effect may appear only in later periods (delayed response), making the overall ATT look weak or masking short-term fluctuations.</p></li>
<li><p>Heterogeneity: The treatment effect might not be constant — it could strengthen or fade over time.</p></li>
<li><p>Power: With smaller sample sizes in individual time periods, the quarterly estimates may have wider confidence intervals, even if the average effect is clear when pooling post-treatment periods.</p></li>
</ul>
<p>This breakdown allows for a more nuanced interpretation of the treatment’s impact and highlights the importance of analyzing treatment dynamics over time.</p>
</section>
<section id="non-textbook-more-complicated-did-example" class="level1">
<h1>Non-Textbook (More Complicated) DID Example</h1>
<p>##Introducing Dataset</p>
<p>To reinforce the mechanics of DID in a more complicated setting, we now turn to a cross-country time series data. This dataset contains a short panel of 7 countries, from 1990 to 1999. Unlike the organ donation example, this dataset includes a richer set of covariates and allows us to simulate treatment assignment and explore how DID performs with and without control variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>PracData <span class="ot">&lt;-</span> <span class="fu">read.dta</span>(<span class="st">"https://www.princeton.edu/~otorres/Panel101.dta"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(PracData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  country year           y y_bin        x1         x2          x3   opinion op
1       A 1990  1342787840     1 0.2779036 -1.1079559  0.28255358 Str agree  1
2       A 1991 -1899660544     0 0.3206847 -0.9487200  0.49253848     Disag  0
3       A 1992   -11234363     0 0.3634657 -0.7894840  0.70252335     Disag  0
4       A 1993  2645775360     1 0.2461440 -0.8855330 -0.09439092     Disag  0
5       A 1994  3008334848     1 0.4246230 -0.7297683  0.94613063     Disag  0
6       A 1995  3229574144     1 0.4772141 -0.7232460  1.02968037 Str agree  1</code></pre>
</div>
</div>
<section id="setting-treatment-group-variable" class="level2">
<h2 class="anchored" data-anchor-id="setting-treatment-group-variable">Setting Treatment Group Variable</h2>
<p>To set up the Difference-in-Differences design, we first define the treatment group and the treatment period. In this example, countries labeled E, F, and G are considered the treated group — meaning they received the hypothetical policy intervention. All other countries form the control group. The treatment is assumed to begin in 1994, so we create a binary post variable that equals 1 for all years 1994 and later, and 0 for years prior to 1994. These two variables — treated and post — allow us to construct the did interaction term, which identifies observations that belong to the treated group after the policy went into effect.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifying post and prior treatment</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>PracData<span class="sc">$</span>post <span class="ot">=</span> <span class="fu">ifelse</span>(PracData<span class="sc">$</span>year <span class="sc">&gt;=</span> <span class="dv">1994</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Idntifying treated group</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>PracData<span class="sc">$</span>treated <span class="ot">=</span> <span class="fu">ifelse</span>(PracData<span class="sc">$</span>country <span class="sc">==</span> <span class="st">"E"</span> <span class="sc">|</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                          PracData<span class="sc">$</span>country <span class="sc">==</span> <span class="st">"F"</span> <span class="sc">|</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                          PracData<span class="sc">$</span>country <span class="sc">==</span> <span class="st">"G"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="placebo-test-1" class="level2">
<h2 class="anchored" data-anchor-id="placebo-test-1">Placebo test</h2>
<p>To conduct a placebo test, we use only the pre-treatment period (before 1994) and create a fake treatment variable. This variable pretends that the treatment (policy change) occurred in 1992 and 1993. By running our DID model on this restricted dataset, we check whether a treatment effect appears when there should be none. If we observe a significant effect, that may indicate differences in pre-treatment trends — which would violate the parallel trends assumption.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use only pre-treatment data</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>data_pre <span class="ot">&lt;-</span> PracData <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;</span> <span class="dv">1994</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">FakeTreat1 =</span> treated <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1992</span>, <span class="dv">1993</span>),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">FakeTreat2 =</span> treated <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> year <span class="sc">==</span> <span class="dv">1993</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Run placebo DID models</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>placebo1 <span class="ot">&lt;-</span> <span class="fu">feols</span>(y <span class="sc">~</span> FakeTreat1 <span class="sc">|</span> country <span class="sc">+</span> year, <span class="at">data =</span> data_pre)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>placebo2 <span class="ot">&lt;-</span> <span class="fu">feols</span>(y <span class="sc">~</span> FakeTreat2 <span class="sc">|</span> country <span class="sc">+</span> year, <span class="at">data =</span> data_pre)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co"># View model results</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(placebo1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OLS estimation, Dep. Var.: y
Observations: 28
Fixed-effects: country: 7,  year: 4
Standard-errors: Clustered (country) 
                 Estimate Std. Error   t value Pr(&gt;|t|) 
FakeTreat1TRUE -234344010 1705222917 -0.137427  0.89519 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 1.76e+9     Adj. R2: 0.403872
                Within R2: 0.001084</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(placebo2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OLS estimation, Dep. Var.: y
Observations: 28
Fixed-effects: country: 7,  year: 4
Standard-errors: Clustered (country) 
                  Estimate Std. Error   t value Pr(&gt;|t|) 
FakeTreat2TRUE -1748993355 2383172366 -0.733893  0.49069 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 1.721e+9     Adj. R2: 0.430244
                 Within R2: 0.045275</code></pre>
</div>
</div>
<p>The fact that neither FakeTreat1 nor FakeTreat2 is statistically significant supports the parallel trends assumption.</p>
</section>
<section id="did" class="level2">
<h2 class="anchored" data-anchor-id="did">DID</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>PracData <span class="ot">&lt;-</span> PracData <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">did =</span> treated <span class="sc">*</span> post)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>did_model <span class="ot">&lt;-</span> <span class="fu">feols</span>(y <span class="sc">~</span> did <span class="sc">|</span> country <span class="sc">+</span> year, <span class="at">data =</span> PracData)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(did_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OLS estimation, Dep. Var.: y
Observations: 70
Fixed-effects: country: 7,  year: 10
Standard-errors: Clustered (country) 
       Estimate Std. Error  t value Pr(&gt;|t|)    
did -2519511630 1086212146 -2.31954 0.059486 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 2.343e+9     Adj. R2: 0.202443
                 Within R2: 0.063637</code></pre>
</div>
</div>
<p>The DID estimate suggests that the treatment led to a reduction of approximately 2.52 billion units in the outcome for the treated countries, relative to the change observed in the control group. The result is marginally significant at the 10% level</p>
</section>
<section id="did-with-control" class="level2">
<h2 class="anchored" data-anchor-id="did-with-control">DID with control</h2>
<p>In addition to accounting for treatment status and timing, we can improve our DID model by including additional covariates that may influence the outcome. In this dataset, variables such as X1, X2, X3, and opinion can be added to control for country-level characteristics that vary over time and might confound the estimated treatment effect. This approach reflects more realistic applications of DID in observational data settings.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>did_controls <span class="ot">&lt;-</span> <span class="fu">feols</span>(y <span class="sc">~</span> did <span class="sc">+</span> x1 <span class="sc">+</span> x2<span class="sc">+</span> x3<span class="sc">+</span> opinion <span class="sc">|</span> country <span class="sc">+</span> year, <span class="at">data =</span> PracData)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(did_controls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OLS estimation, Dep. Var.: y
Observations: 70
Fixed-effects: country: 7,  year: 10
Standard-errors: Clustered (country) 
                    Estimate Std. Error   t value  Pr(&gt;|t|)    
did              -3730844599  784865728 -4.753481 0.0031474 ** 
x1                2438456300  904991473  2.694452 0.0358396 *  
x2                -170490301 1408750858 -0.121022 0.9076245    
x3                 703676005  327708965  2.147259 0.0753910 .  
opinionAgree      -439601291 1236224249 -0.355600 0.7343080    
opinionDisag      1299662757  871649340  1.491039 0.1865439    
opinionStr disag   894696656  895667398  0.998916 0.3564016    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 2.129e+9     Adj. R2: 0.257532
                 Within R2: 0.226996</code></pre>
</div>
</div>
<p>The DID estimate suggests that the treatment led to a reduction of approximately 3.73.52 billion units in the outcome for the treated countries, relative to the change observed in the control group, after controling the effects of x1, x2, x3, and opinion. The result is marginally significant at the 5% level</p>
</section>
<section id="long-term-effect-1" class="level2">
<h2 class="anchored" data-anchor-id="long-term-effect-1">Long term effect</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate dynamic treatment effects by interacting year with treated group</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>longterm <span class="ot">&lt;-</span> <span class="fu">feols</span>(y <span class="sc">~</span> <span class="fu">i</span>(year, treated, <span class="at">ref =</span> <span class="dv">1993</span>) <span class="sc">|</span> country <span class="sc">+</span> year, <span class="at">data =</span> PracData)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of estimates</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(longterm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>OLS estimation, Dep. Var.: y
Observations: 70
Fixed-effects: country: 7,  year: 10
Standard-errors: Clustered (country) 
                      Estimate Std. Error   t value Pr(&gt;|t|)    
year::1990:treated  1878879632 3389741077  0.554284 0.599419    
year::1991:treated   978954411 2705563477  0.361830 0.729880    
year::1992:treated  2389146024 2543433095  0.939339 0.383815    
year::1994:treated  -353480357 1076719789 -0.328294 0.753844    
year::1995:treated -6693704891 2961983098 -2.259873 0.064559 .  
year::1996:treated  -451797160 2728622050 -0.165577 0.873928    
year::1997:treated   773399515 2888441628  0.267757 0.797853    
year::1998:treated -2977579631 5207486242 -0.571788 0.588230    
year::1999:treated  2456562845 2772778388  0.885957 0.409741    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 2.034e+9     Adj. R2: 0.291941
                 Within R2: 0.294189</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize effects over time</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coefplot</span>(longterm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Tutorial7_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Interestingly, while the Average Treatment Effect on the Treated (ATT) from the standard DID model is statistically significant, none of the individual post-treatment coefficients in the long-term effects model are significant (Well, the effect in 1995 is marginally significant). This can happen when the average effect is consistent but small across periods, or when individual year estimates have more noise and wider confidence intervals, reducing statistical power. It’s also possible that the effect is spread out or varies slightly across time, making no single year stand out on its own. This highlights the importance of looking at both the overall effect and the dynamics of treatment — even when individual time-point effects are not significant, the overall DID estimate can still capture a real, average shift attributable to the treatment.</p>
</section>
</section>
<section id="rollout-design" class="level1">
<h1>Rollout Design</h1>
<p>In many real-world policy settings, treatments are not applied all at once but are instead rolled out over time to different units. This is known as a rollout or staggered adoption design. In such cases, DID can still be applied by leveraging variation in when units are treated. Some units serve as controls early on, but later receive the treatment themselves. To properly estimate the treatment effect, it’s important to keep track of both the timing of treatment and the group that receives it, and to include units that are never treated to serve as clean controls.</p>
<p>Rollout designs, while powerful, place higher demands on the data. Because treatment is staggered across groups and years, we need enough units observed before, during, and after treatment to estimate reliable effects. This requires a larger number of observations and variation across both time and units. Since the <code>PracData</code> dataset contains only 70 observations, it lacks the statistical power and group-time combinations necessary for robust rollout estimation using modern methods like the <code>did</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"mpdta"</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mpdta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    year countyreal     lpop     lemp first.treat treat
866 2003       8001 5.896761 8.461469        2007     1
841 2004       8001 5.896761 8.336870        2007     1
842 2005       8001 5.896761 8.340217        2007     1
819 2006       8001 5.896761 8.378161        2007     1
827 2007       8001 5.896761 8.487352        2007     1
937 2003       8019 2.232377 4.997212        2007     1</code></pre>
</div>
</div>
<p>To address this, we switch to the mpdta dataset, which contains over 2,500 observations. The dataset contains 500 observations of county-level teen employment rates from 2003-2007. Some states are first treated in 2004, some in 2006, and some in 2007. The important variables in the dataset are</p>
<ul>
<li><p><code>lemp</code> This is the log of county-level teen employment. It is the outcome variable</p></li>
<li><p><code>first.treat</code> This is the period when a state first increases its minimum wage. It can be 2004, 2006, or 2007. It is the variable that defines group in this application</p></li>
<li><p><code>year</code> This is the year and is the time variable</p></li>
<li><p><code>countyreal</code> This is an id number for each county and provides the individual identifier in this panel data context</p></li>
</ul>
<p>To estimate group-time average treatment effects, use the <code>att_gt</code> function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">att_gt</span>(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">yname =</span> <span class="st">"lemp"</span>,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">gname =</span> <span class="st">"first.treat"</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">idname =</span> <span class="st">"countyreal"</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">tname =</span> <span class="st">"year"</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">xformla =</span> <span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> mpdta,</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">est_method =</span> <span class="st">"reg"</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
att_gt(yname = "lemp", tname = "year", idname = "countyreal", 
    gname = "first.treat", xformla = ~1, data = mpdta, est_method = "reg")

Reference: Callaway, Brantly and Pedro H.C. Sant'Anna.  "Difference-in-Differences with Multiple Time Periods." Journal of Econometrics, Vol. 225, No. 2, pp. 200-230, 2021. &lt;https://doi.org/10.1016/j.jeconom.2020.12.001&gt;, &lt;https://arxiv.org/abs/1803.09015&gt; 

Group-Time Average Treatment Effects:
 Group Time ATT(g,t) Std. Error [95% Simult.  Conf. Band]  
  2004 2004  -0.0105     0.0256       -0.0782      0.0572  
  2004 2005  -0.0704     0.0323       -0.1558      0.0149  
  2004 2006  -0.1373     0.0403       -0.2438     -0.0307 *
  2004 2007  -0.1008     0.0349       -0.1931     -0.0085 *
  2006 2004   0.0065     0.0240       -0.0569      0.0699  
  2006 2005  -0.0028     0.0198       -0.0550      0.0495  
  2006 2006  -0.0046     0.0178       -0.0516      0.0425  
  2006 2007  -0.0412     0.0204       -0.0952      0.0128  
  2007 2004   0.0305     0.0155       -0.0104      0.0714  
  2007 2005  -0.0027     0.0177       -0.0494      0.0440  
  2007 2006  -0.0311     0.0195       -0.0825      0.0203  
  2007 2007  -0.0261     0.0170       -0.0709      0.0188  
---
Signif. codes: `*' confidence band does not cover 0

P-value for pre-test of parallel trends assumption:  0.16812
Control Group:  Never Treated,  Anticipation Periods:  0
Estimation Method:  Outcome Regression</code></pre>
</div>
</div>
<p>From the model output, we can see the ATT for Group 2004 are statiscially significant in years 2006 and 2007. However, we don’t see any other significance in other groups or years.</p>
<p>We can also visualize for easier interpretation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdid</span>(out, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">25</span>, .<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Tutorial7_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>